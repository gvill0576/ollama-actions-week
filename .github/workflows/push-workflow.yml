name: Push Workflow

on:
  push:
    branches:
      - main

env:
  COURSE_NAME: "AI Cloud and DevOps Bootcamp"
  COHORT: "Echo"

jobs:
  setup:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Verify name.txt exists
        run: |
          if [ ! -f name.txt ]; then
            echo "ERROR: name.txt not found!"
            exit 1
          fi
          echo "✓ name.txt exists"
      
      - name: Verify devops.txt exists
        run: |
          if [ ! -f devops.txt ]; then
            echo "ERROR: devops.txt not found!"
            exit 1
          fi
          echo "✓ devops.txt exists"
  
  build:
    needs: setup
    runs-on: ubuntu-latest
    
    env:
      REPORT_TITLE: "Automated Workflow Summary"
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Create log file
        run: |
          echo "Workflow executed at: $(date)" > log.txt
          echo "This workflow was triggered by a push to main" >> log.txt
      
      - name: Print working directory
        run: pwd
      
      - name: Display log contents
        run: cat log.txt
      
      - name: Read name.txt
        run: |
          echo "=== My Name ==="
          cat name.txt
      
      - name: Read devops.txt
        run: |
          echo "=== Why I'm Learning DevOps ==="
          cat devops.txt
      
      - name: Generate summary report
        run: |
          echo "=== $REPORT_TITLE ===" > summary.txt
          echo "Generated at: $(date)" >> summary.txt
          echo "Course: $COURSE_NAME" >> summary.txt
          echo "Cohort: $COHORT" >> summary.txt
          echo "Triggered by: ${{ github.actor }}" >> summary.txt
          echo "Repository: ${{ github.repository }}" >> summary.txt
          echo "" >> summary.txt
          echo "Name:" >> summary.txt
          cat name.txt >> summary.txt
          echo "" >> summary.txt
          echo "DevOps Motivation:" >> summary.txt
          cat devops.txt >> summary.txt
      
      - name: Upload summary artifact
        uses: actions/upload-artifact@v4
        with:
          name: summary-report
          path: summary.txt
  
  report:
    needs: build
    runs-on: ubuntu-latest
    
    steps:
      - name: Download summary artifact
        uses: actions/download-artifact@v4
        with:
          name: summary-report
      
      - name: Display final summary report
        run: |
          echo "=== FINAL REPORT ==="
          cat summary.txt
      
      - name: Print completion message
        run: echo "✓ Workflow completed successfully!"
